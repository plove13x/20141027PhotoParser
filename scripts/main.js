!function(){"use strict";window.App={},App.Models={},App.Collections={},App.Views={},App.Routers={},App.Post=Parse.Object.extend({className:"post",defaults:{likes:0}}),App.User=Parse.Object.extend({className:"User"}),App.Comment=Parse.Object.extend({className:"comment"}),App.Posts=Parse.Collection.extend({model:App.Post}),App.BaseView=Parse.View.extend({template:_.template($('[data-template-name="base"]').text()),initialize:function(){this.model=Parse.User.current(),this.render()},render:function(){this.$el.html(this.template()),window.pHeader=new App.HeaderView({$container:$("header"),model:this.model})}}),App.HeaderView=Parse.View.extend({template:_.template($('[data-template-name="headerContent"]').html()),initialize:function(e){var t=_.defaults({},e,{$container:e.$container});t.$container.html(this.el),this.render()},events:{"click .logIn":"logIn","click .logOut":"logOut","click .addPhoto":"addPhoto"},render:function(){this.model=Parse.User.current(),this.$el.html(this.template())},addPhoto:function(){PPRouter.navigate("/posts/create",{trigger:!0})},logIn:function(){PPRouter.navigate("/login",{trigger:!0}),pHeader.render()},logOut:function(){Parse.User.logOut(),PPRouter.navigate("/login",{trigger:!0}),pHeader.render()}}),App.LogInView=Parse.View.extend({template:_.template($('[data-template-name="login"]').text()),events:{submit:"userLogIn"},userLogIn:function(e){console.log("userLogin"),e.preventDefault(),Parse.User.logOut();var t=(this.$(".email-input").val(),this.$(".password-input").val()),n=this.$(".username-input").val();Parse.User.logIn(n,t,{success:function(){console.log(n),window.uzer=n,PPRouter.navigate("/posts",{trigger:!0})},error:function(){console.log("n")}}).then(function(){pHeader.render()})},initialize:function(e){e.$container.html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this}}),App.RegisterView=Parse.View.extend({template:_.template($('[data-template-name="register"]').text()),events:{submit:"userRegister"},userRegister:function(e){e.preventDefault();var t=this.$(".email-input").val(),n=this.$(".password-input").val(),i=this.$(".username-input").val(),s=new Parse.User;s.set("username",i),s.set("password",n),s.set("email",t),s.signUp(null,{success:function(){},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})},initialize:function(e){e.$container.html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this}}),App.OtherUserIndexView=Parse.View.extend({template:_.template($('[data-template-name="otherUser/index"]').text()),tagName:"ul",initialize:function(e){e.$container.html(this.el),this.render()},render:function(){this.collection.each(_.bind(this.renderChild,this)),this.$el.prepend(this.template({posts:this.collection.toJSON()}))},renderChild:function(e){var t=new App.IndexPhotoListItemView({model:e,$container:this.$el});this.$el.append(t.el)}}),App.IndexPhotoListItemView=Parse.View.extend({tagName:"li",template:_.template($('[data-template-name="photoListItem"]').text()),initialize:function(e){_.defaults({},e,{$container:e.$container});this.render()},render:function(){this.$el.prepend(this.template({post:this.model.toJSON()}))}}),App.PostsIndexView=Parse.View.extend({template:_.template($('[data-template-name="posts/index"]').text()),initialize:function(e){e.$container.html(this.el),this.render()},render:function(){console.log(this.collection),this.$el.html(this.template({posts:this.collection.toJSON()})),console.log(this.collection)}}),App.PostsCreateView=Parse.View.extend({template:_.template($('[data-template-name="posts/create"]').text()),initialize:function(e){e.$container.html(this.el),this.model=new App.Post,window.post=this.model,this.render(),_.bindAll(this,"render"),this.model.on("change",this.render)},render:function(){return this.$el.html(this.template({model:this.model.toJSON()})),this},events:{submit:"createPost","change input[type=file]":"uploadFile"},uploadFile:function(e){var t=$(e.target)[0].files[0],n=new Parse.File(t.name,t),i=this;n.save().then(function(){i.model.set("image",n.url())})},createPost:function(e){e.preventDefault(),this.model.set({title:this.$(".title").val(),url:this.$(".url").val(),author:Parse.User.current()}),post.save().then(function(){PPRouter.navigate("posts",{trigger:!0})})}}),App.SinglePhotoView=Parse.View.extend({template:_.template($('[data-template-name="singlePhoto"]').text()),initialize:function(e){var t=_.defaults({},e,{$container:e.$container});t.$container.html(this.el),this.render()},events:{"click .composeComment":"composeComment","click .like":"like"},composeComment:function(){new App.CommentFormView({$container:$("aside"),model:this.model})},like:function(){this.model.increment("likes"),this.model.save()},render:function(){this.$el.html(this.template({post:this.model.toJSON(),comments:this.collection.toJSON()}))}}),App.CommentFormView=Parse.View.extend({tagName:"form",template:_.template($('[data-template-name="commentForm"]').text()),initialize:function(e){var t=_.defaults({},e,{$container:e.$container});t.$container.append(this.el),this.render()},events:{submit:"submitComment"},submitComment:function(e){e.preventDefault();var t=this.model,n=this.$(".commentBody").val(),i=new App.Comment;i.set("post",t),i.set("commentBody",n),i.set("author",Parse.User.current()),i.save(),this.remove()},render:function(){this.$el.html(this.template({}))}}),App.AppRouter=Parse.Router.extend({routes:{"":"index",login:"login",register:"register",posts:"postsIndex","posts/create":"postsCreate",":authorName":"otherUserIndex","post/:post_id":"post",setlang:"renderSetLanguages",messenger:"renderMessenger"},initialize:function(){new App.BaseView({el:"body"})},index:function(){Parse.User.current()?this.navigate("/posts",{trigger:!0}):this.navigate("/login",{trigger:!0})},login:function(){this.swap(new App.LogInView({$container:$(".container")}))},register:function(){this.swap(new App.RegisterView({$container:$(".container")}))},otherUserIndex:function(e){var t=new Parse.Query(App.User);t.equalTo("username",e);var n=new Parse.Query(App.Post);n.matchesQuery("author",t);var i=n.collection(),s=this;i.fetch().then(function(){s.swap(new App.OtherUserIndexView({collection:i,$container:$(".container")}))})},post:function(e){var t=new Parse.Query(App.Post);t.equalTo("objectId",e);var n=new Parse.Query(App.Comment);n.matchesQuery("post",t);var i=n.collection();i.fetch().then(function(){console.log(i);var t=new Parse.Query(App.Post);t.equalTo("objectId",e),t.first().then(function(e){new App.SinglePhotoView({$container:$(".container"),model:e,collection:i})})})},postsIndex:function(){var e=new Parse.Query(App.Post);e.equalTo("author",Parse.User.current());var t=e.collection(),n=this;t.fetch().then(function(){n.swap(new App.PostsIndexView({collection:t,$container:$(".container")}))})},postsCreate:function(){this.swap(new App.PostsCreateView({$container:$(".container")}))},swap:function(e){this.currentView&&(this.currentView.remove(),this.currentView=e)}}),Parse.initialize("LyWY44CklJfoUT82opx55PgKeQFXgU076IP8dzd9","HB7stHrSgvG7AST6XVclCA2lFifzHC1YDr1GH89M"),window.PPRouter=new App.AppRouter,Parse.history.start()}();